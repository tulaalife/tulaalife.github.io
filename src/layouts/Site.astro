---
import FooterCard from "../components/FooterCard.astro";
import { ClientRouter } from "astro:transitions";

interface Props {
    title: string;
    description?: string;
    canonicalPath?: string;
    ogImage?: string;
    hideFooter?: boolean;
}

const {
    title,
    description = "Your private sanctuary for holistic wellness. Yoga, meditation, and tracking—offline and free.",
    canonicalPath = "/",
    ogImage = "https://images.tulaa.life/logo.webp", // Ensure this exists or update
    hideFooter = false,
} = Astro.props;

const site = "https://tulaalife.com";
const url = new URL(canonicalPath, site).toString();
const socialImage = ogImage.startsWith("http")
    ? ogImage
    : new URL(ogImage, site).toString();
---

<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="color-scheme" content="light dark" />
        <meta name="theme-color" content="#ffffff" id="theme-color-meta" />

        <title>{title}</title>

        <meta name="description" content={description} />
        <link rel="canonical" href={url} />
        <meta name="robots" content="index,follow" />

        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="Tulaa" />
        <meta property="og:url" content={url} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={socialImage} />

        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={socialImage} />

        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

        <ClientRouter />

        <script is:inline>
            (() => {
                const root = document.documentElement;
                const metaColor = document.getElementById("theme-color-meta");

                // Define precise background colors for browser chrome (address bar)
                const bgColors = {
                    light: "#ffffff",
                    dark: "#18181b",
                };

                function getSystemTheme() {
                    return window.matchMedia("(prefers-color-scheme: dark)")
                        .matches
                        ? "dark"
                        : "light";
                }

                function init() {
                    // Check local storage or fallback to system preference
                    const saved = localStorage.getItem("tulaa-theme");
                    const theme = saved || getSystemTheme();

                    root.dataset.theme = theme;
                    root.style.colorScheme = theme;
                    if (metaColor)
                        metaColor.setAttribute("content", bgColors[theme]);
                }

                init();
                document.addEventListener("astro:page-load", init);

                // Global Toggle Function
                window.toggleTheme = function () {
                    const current =
                        root.dataset.theme === "dark" ? "dark" : "light";
                    const next = current === "dark" ? "light" : "dark";

                    root.dataset.theme = next;
                    root.style.colorScheme = next;
                    localStorage.setItem("tulaa-theme", next);

                    if (metaColor)
                        metaColor.setAttribute("content", bgColors[next]);
                };
            })();
        </script>

        <link
            rel="preload"
            as="font"
            type="font/woff2"
            href="/fonts/InterVariable.woff2"
            crossorigin
        />
        <style>
            @font-face {
                font-family: "Inter Var";
                src:
                    local("InterVariable"),
                    url("/fonts/InterVariable.woff2") format("woff2");
                font-weight: 100 900;
                font-display: swap;
            }
        </style>

        <style is:global>
            /* =========================================
               RESET & BASE
               ========================================= */
            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }
            html,
            body {
                margin: 0;
                padding: 0;
                width: 100%;
                overflow-x: hidden;
            }

            /* =========================================
               DESIGN SYSTEM (Streamlined)
               ========================================= */
            :root {
                /* Layout */
                --container-width: 1120px; /* Wider for better screenshot grids */
                --header-height: 64px;
                --radius-lg: 24px;
                --radius-md: 16px;
                --radius-sm: 8px;

                /* Typography */
                --font-sans:
                    "Inter Var", -apple-system, BlinkMacSystemFont, sans-serif;
                --fw-regular: 400;
                --fw-medium: 500;
                --fw-semibold: 600;
                --fw-bold: 750; /* Slightly bolder for headers */

                /* Font Sizes (Fluid) */
                --text-display: clamp(2.5rem, 5vw, 3.75rem); /* Big Hero Text */
                --text-h1: clamp(2rem, 3.5vw, 2.5rem);
                --text-h2: clamp(1.5rem, 2.5vw, 2rem);
                --text-h3: 1.25rem;
                --text-body: 1.05rem; /* Slightly larger for readability */
                --text-sm: 0.9rem;
            }

            .page-content {
                padding-top: var(--header-height);
            }

            /* --- LIGHT THEME (Apple / Zen Style) --- */
            :root[data-theme="light"] {
                --bg-main: oklch(100% 0 0); /* Pure White */
                --bg-sub: oklch(
                    97% 0 0
                ); /* Very light grey for cards/sections */

                --text-main: oklch(20% 0 0); /* Soft Black */
                --text-muted: oklch(50% 0 0); /* Grey */

                --primary: oklch(62% 0.14 145); /* Tulaa Sage Green */
                --primary-fg: oklch(98% 0 0); /* Text on primary button */

                --border: oklch(92% 0 0); /* Subtle borders */
                --shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            }

            /* --- DARK THEME (OLED / Night) --- */
            :root[data-theme="dark"] {
                --bg-main: oklch(15% 0.01 145); /* Deep Charcoal/Green tint */
                --bg-sub: oklch(18% 0.01 145);

                --text-main: oklch(96% 0 0); /* White */
                --text-muted: oklch(65% 0 0);

                --primary: oklch(70% 0.12 145); /* Lighter Sage for dark mode */
                --primary-fg: oklch(15% 0.02 145);

                --border: oklch(25% 0 0);
                --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }

            /* =========================================
               GLOBAL STYLES
               ========================================= */
            body {
                font-family: var(--font-sans);
                font-size: var(--text-body);
                line-height: 1.6;
                color: var(--text-main);
                background-color: var(--bg-main);
                transition:
                    background-color 0.3s ease,
                    color 0.3s ease;
                /* Anti-aliasing for that crisp look */
                -webkit-font-smoothing: antialiased;
            }

            img,
            video {
                max-width: 100%;
                height: auto;
                display: block;
            }

            h1,
            h2,
            h3,
            h4 {
                margin: 0;
                font-weight: var(--fw-bold);
                line-height: 1.15;
                color: var(--text-main);
                letter-spacing: -0.025em; /* Tight tracking for modern feel */
            }

            a {
                color: inherit;
                text-decoration: none;
            }

            /* Utility Classes */
            .container {
                max-width: var(--container-width);
                margin: 0 auto;
                padding: 0 24px;
            }

            /* Header Styles */
            header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: var(--header-height);
                z-index: 50;
                /* Glassmorphism */
                background: color-mix(in srgb, var(--bg-main), transparent 15%);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid
                    color-mix(in srgb, var(--border), transparent 50%);
            }

            header .inner {
                display: flex;
                align-items: center;
                justify-content: space-between;
                height: 100%;
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 10px;
                font-weight: var(--fw-bold);
                font-size: 1.1rem;
                letter-spacing: -0.01em;
            }
            .logo img {
                width: 32px;
                height: 32px;
                border-radius: 8px;
            }

            .theme-toggle {
                background: none;
                border: none;
                cursor: pointer;
                color: var(--text-main);
                padding: 8px;
                border-radius: 50%;
                transition: background 0.2s;
            }
            .theme-toggle:hover {
                background: var(--bg-sub);
            }

            /* Footer */
            footer {
                margin-top: 80px;
                padding-bottom: 40px;
                text-align: center;
                color: var(--text-muted);
            }
            footer a:hover {
                color: var(--text-main);
                text-decoration: underline;
            }
            .legal {
                margin-top: 24px;
                display: flex;
                gap: 24px;
                justify-content: center;
                font-size: var(--text-sm);
            }
        </style>
    </head>

    <body>
        <header>
            <div class="container inner">
                <a href="/" class="logo">
                    <img
                        src="https://images.tulaa.life/logo.webp"
                        alt="Tulaa Logo"
                    />
                    <span>Tulaa</span>
                </a>

                <button
                    id="themeBtn"
                    class="theme-toggle"
                    aria-label="Toggle Theme"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><circle cx="12" cy="12" r="5"></circle><path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                        ></path></svg
                    >
                </button>
            </div>
        </header>

        <main class="page-content">
            <slot />
        </main>

        {
            !hideFooter && (
                <footer>
                    <div class="container">
                        <FooterCard />
                        <div class="legal">
                            <a href="/legal/privacy">Privacy</a>
                            <a href="/legal/terms">Terms</a>
                            <a href="mailto:contact@tulaalife.com">Contact</a>
                        </div>
                        <p style="font-size: 0.8rem; margin-top: 20px; opacity: 0.6;">
                            © {new Date().getFullYear()} Tulaalife Wellness.
                            Made with care.
                        </p>
                    </div>
                </footer>
            )
        }

        <script>
            // 1. Tell TypeScript about our custom function
            declare global {
                interface Window {
                    toggleTheme: () => void;
                }
            }

            // 2. Your event listener code
            document.addEventListener("astro:page-load", () => {
                const btn = document.getElementById("themeBtn");
                if (btn) {
                    btn.addEventListener("click", () => window.toggleTheme());
                }
            });
        </script>
    </body>
</html>
