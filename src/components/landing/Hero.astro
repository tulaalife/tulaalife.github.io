---
import StoreButtons from "../StoreButtons.astro";
---

<link rel="preload" as="image" href="/poster.webp" />

<section id="hero" class="hero-section">
    <div class="container hero-grid">
        <div class="hero-content">
            <div class="badge">100% Free & Offline</div>
            <h1 class="hero-title">
                Your Private Sanctuary for <span class="text-gradient"
                    >Holistic Wellness.</span
                >
            </h1>
            <p class="hero-sub">
                Find your balance with expert-led yoga, meditation, and mindful
                journaling.
                <strong>No login. No subscription. No internet needed.</strong>
            </p>

            <div class="cta-wrapper">
                <StoreButtons centered={false} />
            </div>

            <div class="trust-pill">
                <span class="dot"></span> Curated by Latika Bissa (M.Sc Yoga Therapy)
            </div>
        </div>

        <div class="hero-visual">
            <div class="phone-frame-wrapper skeleton-loader" id="phoneWrapper">
                <video
                    id="heroVideo"
                    class="app-video"
                    loop
                    muted
                    playsinline
                    preload="none"
                    width="300"
                    height="533"></video>
                <div class="glow-blob"></div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const wrapper = document.getElementById("phoneWrapper");
        const video = document.getElementById("heroVideo") as HTMLVideoElement;

        if (!wrapper || !video) return;

        // --- PART 1: Poster Loading ---
        const img = new Image();
        img.src = "/poster.webp";

        const showPoster = () => {
            wrapper.classList.remove("skeleton-loader");
            wrapper.style.backgroundImage = `url('${img.src}')`;
            wrapper.classList.add("has-poster");
        };

        if (img.complete) {
            showPoster();
        } else {
            img.onload = showPoster;
            setTimeout(showPoster, 3000);
        }

        // --- PART 2: Video Loading ---
        interface NetworkInformation {
            saveData?: boolean;
            effectiveType?: "slow-2g" | "2g" | "3g" | "4g";
        }
        interface ExtendedNavigator extends Navigator {
            connection?: NetworkInformation;
            mozConnection?: NetworkInformation;
            webkitConnection?: NetworkInformation;
        }

        const nav = navigator as ExtendedNavigator;
        const connection =
            nav.connection || nav.mozConnection || nav.webkitConnection;

        const isSlow =
            connection &&
            (connection.saveData ||
                ["slow-2g", "2g"].includes(connection.effectiveType || ""));

        if (isSlow) {
            console.log("Very slow connection detected. Keeping poster.");
            return;
        }

        const initVideo = () => {
            const sources = [
                { src: "/website-app-demo.webm", type: "video/webm" },
                { src: "/website-app-demo.mp4", type: "video/mp4" },
            ];

            sources.forEach((s) => {
                const source = document.createElement("source");
                source.src = s.src;
                source.type = s.type;
                video.appendChild(source);
            });

            video.addEventListener(
                "canplay",
                () => {
                    video
                        .play()
                        .then(() => {
                            video.classList.add("is-playing");
                        })
                        .catch((e) => console.error("Autoplay blocked", e));
                },
                { once: true },
            );

            video.load();
        };

        if ("requestIdleCallback" in window) {
            // @ts-ignore
            requestIdleCallback(initVideo);
        } else {
            setTimeout(initVideo, 200);
        }
    });
</script>

<style>
    /* ... (Keep existing Layout Styles) ... */
    .hero-section {
        padding-top: 140px;
        padding-bottom: 80px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .hero-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 60px;
        align-items: center;
        width: 100%;
    }
    .badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 99px;
        background: var(--bg-sub);
        color: var(--primary);
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 24px;
        border: 1px solid var(--border);
    }
    .hero-title {
        font-size: var(--text-display);
        line-height: 1.1;
        margin-bottom: 24px;
    }
    .text-gradient {
        background: linear-gradient(
            135deg,
            var(--primary),
            color-mix(in srgb, var(--primary), black 20%)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .hero-sub {
        font-size: 1.2rem;
        color: var(--text-muted);
        margin-bottom: 40px;
        max-width: 500px;
    }
    .cta-wrapper {
        display: flex;
        justify-content: flex-start;
        width: 100%;
    }
    .trust-pill {
        margin-top: 32px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--text-muted);
        background: var(--bg-sub);
        padding: 8px 16px;
        border-radius: 99px;
    }
    .dot {
        width: 8px;
        height: 8px;
        background-color: #22c55e;
        border-radius: 50%;
    }

    /* --- UPDATED VISUAL STYLES --- */

    .phone-frame-wrapper {
        position: relative;
        width: 280px;
        margin: 0 auto;
        z-index: 2;

        aspect-ratio: 540 / 1174;

        background-color: #000;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;

        border-radius: 36px;
        border: 10px solid #1a1a1a;

        overflow: hidden;
    }

    /* Subtle Shimmer: Darker gradient for premium feel */
    .phone-frame-wrapper.skeleton-loader::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* Much more subtle gradient */
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0) 0%,
            rgba(255, 255, 255, 0.03) 50%,
            rgba(255, 255, 255, 0) 100%
        );
        transform: translateX(-100%);
        animation: shimmer 2s infinite; /* Slower animation */
        z-index: 5;
        pointer-events: none;
    }

    @keyframes shimmer {
        100% {
            transform: translateX(100%);
        }
    }

    .app-video {
        position: absolute;
        inset: 0;

        width: 100%;
        height: 100%;

        object-fit: cover;

        /* ðŸ‘‡ IMPORTANT FIX */
        border-radius: 26px; /* 36 - 10 */

        opacity: 0;
        transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);

        z-index: 10;
    }

    .app-video.is-playing {
        opacity: 1;
    }

    :global([data-theme="dark"]) .phone-frame-wrapper {
        border-color: #0a0a0a;
    }

    .glow-blob {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120%;
        height: 80%;
        background: var(--primary);
        filter: blur(80px);
        opacity: 0.2;
        z-index: -1;
    }

    @media (max-width: 768px) {
        .hero-section {
            padding-top: 80px;
            padding-bottom: 60px;
            min-height: 100dvh;
        }
        .hero-grid {
            grid-template-columns: 1fr;
            text-align: center;
            gap: 30px;
        }
        .cta-wrapper {
            justify-content: center;
        }
        .hero-content {
            order: 2;
        }
        .hero-visual {
            order: 1;
            margin-bottom: 10px;
        }
        .hero-sub {
            margin-left: auto;
            margin-right: auto;
        }
        .hero-title {
            font-size: 2.5rem;
        }
    }
</style>
