---
import Site from "../../layouts/Site.astro";
import CTAButton from "../../components/CTAButton.astro";
import { guidedAudios } from "../../data/generated";

export async function getStaticPaths() {
    return guidedAudios.map((a) => ({
        params: { slug: a.slug },
        props: { audio: a },
    }));
}

const { audio } = Astro.props;
const lang = audio.language || "en";
const canonical = `/audio/${audio.slug}`;

const LABELS = {
    hi: {
        back: "‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç",
        tag: "‡§ó‡§æ‡§á‡§°‡•á‡§° ‡§ë‡§°‡§ø‡§Ø‡•ã",
        listen: "Tulaa ‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§∞‡§æ ‡§∏‡•á‡§∂‡§® ‡§∏‡•Å‡§®‡•á‡§Ç‡•§",
        btnApp: "‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ‡§è‡§Ç",
        btnBrowse: "‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç",
    },
};

const t = LABELS[lang as keyof typeof LABELS] || {
    back: "Back to Library",
    tag: "Guided Audio",
    listen: "Listen to the full session offline in the Tulaa app.",
    btnApp: "Play in App",
    btnBrowse: "Browse Library",
};
---

<Site
    title={`${audio.title} ¬∑ Tulaa`}
    description={audio.teaser || "Gentle audio preview from Tulaa."}
    canonicalPath={canonical}
    ogImage={audio.image}
>
    <div class="content-shell">
        <article class="audio-detail">
            <!-- Back -->
            <nav class="audio-nav">
                <a href="/audio" class="back-link">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    {t.back}
                </a>
            </nav>

            <!-- Hero -->
            <div class="image-stage">
                <div class="image-frame">
                    <img
                        src={audio.image}
                        alt={audio.title}
                        width="1200"
                        height="630"
                        loading="eager"
                    />
                    <div class="play-overlay">
                        <div class="play-button">‚ñ∂</div>
                    </div>
                </div>
            </div>

            <!-- Header -->
            <div class="audio-header">
                <h1 class="audio-title">{audio.title}</h1>
                {
                    audio.subtitle && (
                        <p class="audio-subtitle">{audio.subtitle}</p>
                    )
                }
            </div>

            <!-- Body -->
            <div class="audio-body">
                {audio.teaser && <p class="audio-lead">{audio.teaser}</p>}
            </div>

            <!-- Footer -->
            <footer class="audio-footer">
                <div class="app-prompt">
                    üéß {t.listen}
                </div>

                <div class="button-group">
                    <CTAButton
                        href={audio.deeplink}
                        label={t.btnApp}
                        variant="solid"
                        size="md"
                    />
                    <CTAButton
                        href="/audio"
                        label={t.btnBrowse}
                        variant="soft"
                        size="md"
                    />
                </div>
            </footer>
        </article>
    </div>
</Site>

<style>
    .content-shell {
        max-width: 880px;
        margin: 0 auto;
        padding: 40px 20px 80px;
    }

    .audio-detail {
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    /* =========================
       NAV
    ========================== */
    .audio-nav {
        display: flex;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        font-size: 0.95rem;
        font-weight: var(--fw-medium);
        color: var(--text-muted);
        transition: all 0.2s ease;
    }

    .back-link:hover {
        color: var(--primary);
        transform: translateX(-2px);
    }

    /* =========================
       HERO
    ========================== */

    .image-stage {
        display: flex;
        justify-content: center;
    }

    .image-frame {
        width: 100%;
        max-width: 600px;
        aspect-ratio: 1 / 1;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        background: var(--bg-sub);
        position: relative;
    }

    .image-frame img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
    }

    .image-frame:hover img {
        transform: scale(1.04);
    }

    .play-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .image-frame:hover .play-overlay {
        opacity: 1;
    }

    .play-button {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: white;
        color: black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        padding-left: 4px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .image-frame:hover .play-button {
        transform: scale(1);
    }

    /* =========================
       HEADER
    ========================== */

    .audio-header {
        text-align: center;
        max-width: 720px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .tag-pill {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: var(--fw-semibold);
        color: var(--primary);
        background: var(--bg-sub);
        border: 1px solid var(--border);
        padding: 6px 14px;
        border-radius: 999px;
        width: fit-content;
        margin: 0 auto;
    }

    .audio-title {
        font-size: clamp(2rem, 4vw, 2.75rem);
        line-height: 1.15;
        letter-spacing: -0.03em;
    }

    .audio-subtitle {
        font-size: 1.1rem;
        color: var(--text-muted);
        line-height: 1.6;
        max-width: 600px;
        margin: 0 auto;
    }

    /* =========================
       BODY
    ========================== */

    .audio-body {
        max-width: 720px;
        margin: 0 auto;
        text-align: center;
    }

    .audio-lead {
        font-size: 1.15rem;
        line-height: 1.7;
        color: var(--text-main);
    }

    /* =========================
       FOOTER
    ========================== */

    .audio-footer {
        margin-top: 32px;
        padding-top: 32px;
        border-top: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        text-align: center;
    }

    .app-prompt {
        font-size: 0.95rem;
        color: var(--text-muted);
    }

    .button-group {
        display: flex;
        gap: 14px;
        flex-wrap: wrap;
        justify-content: center;
    }

    /* =========================
       MOBILE
    ========================== */

    @media (max-width: 600px) {
        .content-shell {
            padding: 24px 16px 60px;
        }

        .audio-title {
            font-size: 1.8rem;
        }
    }
</style>
