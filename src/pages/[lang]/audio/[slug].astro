---
import CTAButton from "../../../components/CTAButton.astro";
import { guidedAudios } from "../../../data/generated";
import Site from "../../../layouts/Site.astro";

// src/pages/[lang]/audio/[slug].astro

export async function getStaticPaths() {
    // FILTER: Only generate paths for NON-English content
    return guidedAudios
        .filter((a) => a.language !== "en")
        .map((a) => ({
            params: { lang: a.language, slug: a.slug },
            props: { audio: a },
        }));
}

const { audio } = Astro.props;
const { lang } = Astro.params;

// Canonical includes the language prefix
const canonical = `/${lang}/audio/${audio.slug}`;

// Helper to translate UI elements (Basic Map)
const LABELS = {
    hi: {
        back: "‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç", // Back to Library
        tag: "‡§ó‡§æ‡§á‡§°‡•á‡§° ‡§ë‡§°‡§ø‡§Ø‡•ã", // Guided Audio
        listen: "Tulaa ‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§∞‡§æ ‡§∏‡•á‡§∂‡§® ‡§∏‡•Å‡§®‡•á‡§Ç‡•§", // Listen in Tulaa App
        btnApp: "‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ‡§è‡§Ç", // Play in App
        btnBrowse: "‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç", // Browse Library
    },
};

// Fallback to English if string missing
const t = LABELS[lang as keyof typeof LABELS] || {
    back: "Back to Library",
    tag: "Guided Audio",
    listen: "Listen to the full session offline in the Tulaa app.",
    btnApp: "Play in App",
    btnBrowse: "Browse Library",
};
---

<Site
    title={`${audio.title} ¬∑ Tulaa`}
    description={audio.teaser || "Audio session from Tulaa."}
    canonicalPath={canonical}
>
    <div class="content-shell">
        <article class="home-block audio-card">
            <nav class="audio-nav">
                <a href="/audio" class="back-link">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="icon-arrow"><path d="m15 18-6-6 6-6"></path></svg
                    >
                    <span>{t.back}</span>
                </a>
            </nav>

            <header class="audio-header">
                <div class="tag-pill">{t.tag}</div>
                <h1 class="audio-title">{audio.title}</h1>
                {
                    audio.subtitle && (
                        <p class="audio-subtitle">{audio.subtitle}</p>
                    )
                }
            </header>

            <div class="image-stage">
                <div class="image-frame">
                    <img
                        src={audio.image}
                        alt={audio.title}
                        width="1200"
                        height="630"
                        loading="eager"
                    />
                    <div class="play-overlay" aria-hidden="true">
                        <div class="play-button">
                            <svg
                                viewBox="0 0 24 24"
                                width="32"
                                height="32"
                                fill="currentColor"
                            >
                                <path d="M8 5v14l11-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="audio-body">
                {audio.teaser && <p class="audio-lead">{audio.teaser}</p>}
            </div>

            <footer class="audio-footer">
                <div class="app-prompt">
                    <span class="prompt-icon">üéß</span>
                    <p>{t.listen}</p>
                </div>

                <div class="button-group">
                    {/* Deep link now includes lang due to script update */}
                    <CTAButton
                        href={audio.deeplink}
                        label={t.btnApp}
                        variant="solid"
                        size="md"
                    />
                    <CTAButton
                        href="/audio"
                        label={t.btnBrowse}
                        variant="soft"
                        size="md"
                    />
                </div>
            </footer>
        </article>
    </div>
</Site>

<style>
    /* ... Same styles as audio/[slug].astro ... */
    /* Copy the styles from your existing detail page here */
    /* Layout Wrapper */
    .content-shell {
        max-width: 860px;
        margin: 0 auto;
        padding: 0 16px;
    }

    .audio-card {
        display: flex;
        flex-direction: column;
        gap: clamp(24px, 4vw, 36px);
    }

    /* Navigation */
    .audio-nav {
        display: flex;
        justify-content: flex-start;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: var(--fs-body-sm);
        font-weight: var(--fw-medium);
        color: var(--muted);
        text-decoration: none;
        transition:
            color 0.2s,
            transform 0.2s;
    }
    .back-link:hover {
        color: var(--fg);
        transform: translateX(-2px);
    }
    .icon-arrow {
        opacity: 0.7;
    }

    /* Typography */
    .audio-header {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
    }

    .tag-pill {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: var(--fw-bold);
        color: var(--accent);
        background: color-mix(in oklch, var(--accent), transparent 92%);
        padding: 4px 10px;
        border-radius: 99px;
    }

    .audio-title {
        font-size: clamp(2rem, 5vw, 2.8rem);
        line-height: 1.1;
        letter-spacing: -0.02em;
        margin: 0;
        background: linear-gradient(
            180deg,
            var(--fg) 20%,
            color-mix(in oklch, var(--fg), transparent 30%) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .audio-subtitle {
        font-size: var(--fs-body-lg);
        color: var(--muted);
        margin: 0;
        max-width: 600px;
    }

    /* Image Stage */
    .image-stage {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .image-frame {
        position: relative;
        width: 100%;
        max-width: 600px;
        aspect-ratio: 16/9;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid var(--ring);
        box-shadow: var(--elev-2);
        background: var(--bg2);
    }

    .image-frame img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.7s ease;
    }

    .play-overlay {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle,
            rgba(0, 0, 0, 0.1),
            rgba(0, 0, 0, 0.3)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .play-button {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.9);
        color: black;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .play-button svg {
        margin-left: 4px;
    }

    .image-frame:hover img {
        transform: scale(1.04);
    }
    .image-frame:hover .play-overlay {
        opacity: 1;
    }
    .image-frame:hover .play-button {
        transform: scale(1);
    }

    /* Body Text */
    .audio-body {
        max-width: 65ch;
        margin: 0 auto;
        text-align: center;
    }

    .audio-lead {
        font-size: 1.15rem;
        line-height: 1.6;
        color: var(--fg);
        opacity: 0.9;
    }

    /* Footer */
    .audio-footer {
        margin-top: 16px;
        padding-top: 24px;
        border-top: 1px solid var(--ring);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }

    .app-prompt {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--muted);
        font-size: var(--fs-body-sm);
        background: color-mix(in oklch, var(--card), white 50%);
        padding: 8px 16px;
        border-radius: 99px;
        border: 1px solid var(--ring);
    }

    .prompt-icon {
        font-size: 1.2em;
    }

    .button-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }
</style>
