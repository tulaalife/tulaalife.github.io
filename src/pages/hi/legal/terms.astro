---
import { marked } from "marked";
import Site from "../../../layouts/Site.astro";

// 1. Get current language
const currentLang = Astro.currentLocale || "en";

// 2. Dynamic Dictionary
const ui = {
    en: {
        title: "Tulaa — Terms of Use",
        desc: "Tulaa Terms of Use — privacy-first, optional anonymous analytics and crash reporting, no ads.",
        privacyLink: "Privacy Policy",
        help: "Need help?",
    },
    hi: {
        title: "तुला — उपयोग की शर्तें",
        desc: "तुला उपयोग की शर्तें — गोपनीयता-प्रथम, वैकल्पिक अनाम एनालिटिक्स और क्रैश रिपोर्टिंग, कोई विज्ञापन नहीं।",
        privacyLink: "गोपनीयता नीति",
        help: "मदद चाहिए?",
    },
};
const t = ui[currentLang as keyof typeof ui] || ui.en;

// Helper to keep links in the correct language
const getLink = (path: string) => (currentLang === "en" ? path : `/hi${path}`);

// 3. Fetch from Cloudflare R2
const r2Url = `https://legal.tulaalife.com/terms_${currentLang}.md`;
let rawMarkdown = "";

try {
    const response = await fetch(r2Url);
    if (response.ok) {
        rawMarkdown = await response.text();
    } else {
        console.error(`Failed to fetch ${r2Url}: ${response.statusText}`);
        rawMarkdown =
            "### Error\nCould not load the terms of use at this time.";
    }
} catch (e) {
    console.error(`Error fetching ${r2Url}`, e);
    rawMarkdown = "### Error\nCould not load the terms of use at this time.";
}

// 4. Process the markdown
const contentHtml = await marked.parse(rawMarkdown);
---

<Site
    title={t.title}
    description={t.desc}
    canonicalPath="/legal/terms"
    hideFooter={true}
>
    <main class="legal-wrap">
        <div class="markdown-body" set:html={contentHtml} />

        <p class="legal-meta">
            {t.help}
            <a href="mailto:contact@tulaalife.com">contact@tulaalife.com</a>
            · <a href={getLink("/legal/privacy")}>{t.privacyLink}</a>
        </p>

        <script type="application/ld+json" is:inline>
            {
                "@context": "https://schema.org",
                "@type": "WebPage",
                "name": "Tulaa — Terms of Use",
                "url": "https://tulaalife.com/legal/terms",
                "datePublished": "2025-09-16"
            }
        </script>
    </main>
</Site>

<style is:global>
    /* ... (Keep all your existing CSS styles exactly as they are) ... */
    .legal-wrap {
        max-width: 940px;
        margin: 0 auto;
        padding: 24px;
        font-family: var(--font-sans);
    }
    .legal-title {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 12px 0 24px;
        font-size: 1.9rem;
        font-weight: 750;
    }
    .legal-logo {
        vertical-align: middle;
        border-radius: 8px;
    }
    .legal-meta {
        color: var(--muted);
        font-size: 0.9rem;
        margin: 28px 0 18px;
        border-top: 1px solid var(--ring);
        padding-top: 20px;
    }
    .markdown-body h2 {
        margin-top: 28px;
        margin-bottom: 12px;
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--foreground);
    }
    .markdown-body p,
    .markdown-body ul,
    .markdown-body li {
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 12px;
        color: var(--foreground);
    }
    .markdown-body ul {
        padding-left: 24px;
    }
    .markdown-body li {
        margin-bottom: 6px;
    }
    .markdown-body strong {
        font-weight: 600;
    }
    .markdown-body blockquote {
        background: var(--card);
        border: 1px solid var(--ring);
        padding: 16px 18px;
        border-radius: 14px;
        margin: 18px 0;
        margin-inline-start: 0;
        margin-inline-end: 0;
    }
    .markdown-body blockquote p {
        margin-bottom: 0;
    }
    .markdown-body a {
        color: var(--primary);
        text-decoration: underline;
        text-underline-offset: 4px;
    }
</style>
