---
import Site from "../../layouts/Site.astro";
import { yogaPlans } from "../../data/generated";

const PER_PAGE = 20;
const page = Number(Astro.url.searchParams.get("page") ?? 1);
const start = (page - 1) * PER_PAGE;
const items = yogaPlans.slice(start, start + PER_PAGE);
const totalPages = Math.max(1, Math.ceil(yogaPlans.length / PER_PAGE));
---

<Site
    title="Yoga Plans · Tulaa"
    description="Gentle previews of Tulaa yoga plans."
    canonicalPath="/yoga"
>
    <main class="wrap" style="max-width:840px;margin:0 auto;padding:24px;">
        <h1 class="yp-title">Yoga Plans</h1>

        <ul style="list-style:none;padding:0;display:grid;gap:12px;">
            {
                items.map((p) => (
                    <li style="border:1px solid var(--ring);border-radius:14px;padding:12px;">
                        <a
                            href={`/yoga/${p.slug}`}
                            style="text-decoration:none;color:inherit;"
                        >
                            <div style="display:flex;gap:12px;align-items:center;">
                                <img
                                    src={p.image}
                                    alt={p.title}
                                    width="96"
                                    height="54"
                                    loading="lazy"
                                    style="border-radius:8px;object-fit:cover;"
                                />
                                <div>
                                    <h3 class="yp-item-title">{p.title}</h3>
                                    <p class="yp-item-sub">{p.teaser}</p>
                                </div>
                            </div>
                        </a>
                    </li>
                ))
            }
        </ul>

        <nav
            aria-label="Pagination"
            style="margin-top:16px;display:flex;gap:12px;justify-content:center;"
        >
            {page > 1 && <a href={`/yoga?page=${page - 1}`}>← Prev</a>}
            <span class="yp-page-meta">Page {page} / {totalPages}</span>
            {page < totalPages && <a href={`/yoga?page=${page + 1}`}>Next →</a>}
        </nav>
    </main>
</Site>

<style>
    .yp-title {
        margin: 0 0 12px;
        font-family: var(--font-sans);
        font-size: var(--fs-h2);
        font-weight: var(--fw-bold);
        color: var(--fg);
    }

    .yp-item-title {
        margin: 0 0 6px;
        font-family: var(--font-sans);
        font-size: var(--fs-h4);
        font-weight: var(--fw-semibold);
        color: var(--fg);
    }

    .yp-item-sub {
        margin: 0;
        font-family: var(--font-sans);
        font-size: var(--fs-body);
        color: var(--muted);
        line-height: var(--lh-body);
    }

    .yp-page-meta {
        font-family: var(--font-sans);
        font-size: var(--fs-body-sm);
        color: var(--muted);
    }
</style>
